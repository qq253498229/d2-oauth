<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
    <meta name="description" content="">
    <meta name="author" content="">
    <title>登录</title>
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/4.0.0-beta/css/bootstrap.min.css" rel="stylesheet"
          integrity="sha384-/Y6pD6FV/Vv2HJnA6t+vslU6fwYXjCFtcEpHbNJ0lyAFsXTsjBbfaDjzALeQsN6M" crossorigin="anonymous">
    <link href="https://getbootstrap.com/docs/4.0/examples/signin/signin.css" rel="stylesheet" crossorigin="anonymous"/>
</head>
<body>
<div class="container">
    <form class="form-signin needs-validation" novalidate>
        <h2 class="form-signin-heading text-center">注册用户</h2>
        <p>
            <label for="username" class="sr-only">昵称</label>
            <input type="text" id="nickname" name="nickname" class="form-control" placeholder="昵称" required
                   autofocus>
        </p>
        <p>
            <label for="username" class="sr-only">用户名</label>
            <input type="text" id="username" name="username" class="form-control" placeholder="用户名" required>
        </p>
        <p>
            <label for="password" class="sr-only">密码</label>
            <input type="password" id="password" name="password" class="form-control" placeholder="密码" required>
        </p>
        <p class="mb-5">
            <a href="javascript:void(0);" onclick="window.history.back()" class="float-left">返回</a>
        </p>
        <div class="invalid-feedback">
            用户名重复
        </div>
        <div class="btn btn-lg btn-primary btn-block" onclick="submit()">注册</div>
    </form>
</div>
<script>
    function submit() {
        var forms = document.getElementsByClassName('needs-validation');
        var form = forms[0];
        var obj = formSerialize(form);

        forms[0].classList.add('was-validated');
        var xmlHttp;
        if (window.XMLHttpRequest) {
            xmlHttp = new XMLHttpRequest();
        } else {
            // IE6, IE5 浏览器执行代码
            xmlHttp = new ActiveXObject("Microsoft.XMLHTTP");
        }
        xmlHttp.onreadystatechange = function () {
            if (xmlHttp.readyState === 4) {
                if (xmlHttp.status === 302) {
                    alert('用户名已存在');
                } else if (xmlHttp.status === 200) {
                    alert('注册成功');
                }
            }
        };
        xmlHttp.open("POST", "/user", true);
        xmlHttp.setRequestHeader("Content-type", "application/json;charset=utf-8");
        xmlHttp.send(JSON.stringify(obj));
    }

    function formSerialize(form) {
        var arr = {};
        for (var i = 0; i < form.elements.length; i++) {
            var field = form.elements[i];

            switch (field.type) {
                case undefined:
                case 'button':
                case 'file':
                case 'reset':
                case 'submit':
                    break;
                case 'checkbox':
                case 'radio': {
                    if (!field.checked) {
                        break;
                    }
                }
                default: {
                    if (arr[field.name]) {
                        arr[field.name] = arr[field.name] + ',' + field.value;
                    } else {
                        arr[field.name] = field.value;

                    }
                }
            }
        }
        return arr
    }
</script>
</body>
</html>